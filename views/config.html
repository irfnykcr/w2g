<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Config</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-dark-bg text-white h-screen flex flex-col overflow-hidden">
	<header class="bg-dark-bg border-b border-gray-700 px-4 sm:px-6 py-4 flex-shrink-0"></header>
	<div class="bg-dark-card p-6 rounded-lg shadow-md w-160 mx-auto my-auto">
		<h2 class="text-2xl font-bold mb-6 text-center text-turkuazz">Config</h2>
		<div class="mb-6">
			<div class="mb-6">
				<div class="flex items-center space-x-4">
					<label for="vlcport" class="font-semibold text-turkuazz w-32">VLC port</label>
					<input type="number" id="vlcport" name="vlcport" required class="flex-1 p-2 border border-dark-hover rounded-md bg-dark-bg text-white">
				</div>
			</div>
			<div class="mb-6">
				<div class="flex items-center space-x-4">
					<label for="server_endpoint" class="font-semibold text-turkuazz w-32">Server endpoint</label>
					<input type="text" id="server_endpoint" name="server_endpoint" required class="flex-1 p-2 border border-dark-hover rounded-md bg-dark-bg text-white">
				</div>
			</div>
			<div class="mb-6">
				<div class="flex items-center space-x-4">
					<label for="vlc_finder" class="font-semibold text-turkuazz w-32">VLC finder</label>
					<input type="checkbox" id="vlc_finder" name="vlc_finder" class="h-5 w-5 text-turkuazz border-gray-700 rounded focus:ring-turkuazz">
				</div>
			</div>
			<div class="mb-6">
				<div class="flex items-center space-x-4">
					<label for="vlc_path" class="font-semibold text-turkuazz w-32">VLC path</label>
					<input type="text" id="vlc_path" name="vlc_path" required class="flex-1 p-2 border border-dark-hover rounded-md bg-dark-bg text-white">
				</div>
			</div>
			<div class="mb-6">
				<div class="flex items-center space-x-4">
					<label for="vlc_http_pass" class="font-semibold text-turkuazz w-32">VLC http pass</label>
					<input type="text" id="vlc_http_pass" name="vlc_http_pass" required class="flex-1 p-2 border border-dark-hover rounded-md bg-dark-bg text-white">
				</div>
			</div>
			<button id="save-config" type="button" class="w-full p-2 bg-turkuazz text-dark-bg rounded-md hover:bg-dark-turkuazz">Save</button>
		</div>
		<p id="status-text" class="text-center mt-4 hidden"></p>
	</div>
	
</body>
<script src="../assets/js/headers/header.js" defer></script>
<script>
	document.addEventListener("DOMContentLoaded", async () => {
		const vlcPortEl = document.getElementById("vlcport")
		const serverEndpointEl = document.getElementById("server_endpoint")
		const vlcFinderEl = document.getElementById("vlc_finder")
		const vlcPathEl = document.getElementById("vlc_path")
		const vlcHttpPassEl = document.getElementById("vlc_http_pass")
		const saveConfigEl = document.getElementById("save-config")
		const statusTextEl = document.getElementById("status-text")

		const appConfig = await window.electronAPI.getConfig()

		vlcPortEl.value = appConfig.VLC_PORT
		serverEndpointEl.value = appConfig.SERVER_ENDPOINT
		vlcFinderEl.checked = appConfig.VLC_FINDER
		vlcPathEl.value = appConfig.VLC_PATH
		vlcHttpPassEl.value = appConfig.VLC_HTTP_PASS

		saveConfigEl.addEventListener("click", async ()=>{
			const vlcport = parseInt(vlcPortEl.value, 10) || 0
			const serverendpoint = serverEndpointEl.value.trim()
			const vlcfinder = vlcFinderEl.checked
			const vlcpath = vlcPathEl.value.trim()
			const vlchttppass = vlcHttpPassEl.value.trim()

			if (!vlcport || !serverendpoint || !vlcpath || !vlchttppass) {
				const classname = "text-center mt-4 bg-admin"
				statusTextEl.textContent = "Please fill all required fields correctly."
				statusTextEl.className = classname
				setTimeout(() => {
					if (statusTextEl.className === classname){
						statusTextEl.className = "hidden"
					}
				}, 2000)
				return
			}

			const r = await window.electronAPI.saveConfig(vlcport, serverendpoint, vlcfinder, vlcpath, vlchttppass)
			if (r){
				const classlist = "text-center mt-4 bg-dark-turkuazz"
				statusTextEl.textContent = "success"
				statusTextEl.className = classlist
				setTimeout(() => {
					if (statusTextEl.className === classlist) {
						statusTextEl.className = "hidden"
					}
				}, 2000)
			} else {
				const classlist = "text-center mt-4 bg-admin"
				statusTextEl.textContent = "error"
				statusTextEl.className = classlist
				setTimeout(() => {
					if (statusTextEl.className === classlist) {
						statusTextEl.className = "hidden"
					}
				}, 2000)
			}
		})
	})
</script>
</html>
